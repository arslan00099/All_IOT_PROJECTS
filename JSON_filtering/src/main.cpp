#include <Arduino.h>
#include <ArduinoJson.h>
#include <WiFiManager.h>
#include <Preferences.h>

String channelName="";


Preferences preferences;

void getpreferences(){
  preferences.begin("my-app", false);
  channelName=preferences.getString("channel");
  preferences.end();
}


String jsonStr="{\"data\":[{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdee\",\"display_name\":\"robcdee\",\"game_id\":\"509658\",\"game_name\":\"JustChatting\",\"id\":\"169185650\",\"is_live\":false,\"tag_ids\":[],\"tags\":[\"Tokyo\",\"Japan\",\"Outdoors\",\"Cycling\",\"Exploration\",\"Travel\",\"SocialEating\",\"Anime\",\"Speedeating\",\"English\"],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/27b90dee-a5c1-4f04-aaba-52ca8f68f224-profile_image-300x300.png\",\"title\":\"CYCLEATHON2|Day4:Today'sgoalisIshinomaki!~95km|1sub=200m/100bits=40m/$1=40m|!map!progress!vpn\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeenumber1\",\"display_name\":\"robcdeenumber1\",\"game_id\":\"492934\",\"game_name\":\"ResidentEvil7biohazard\",\"id\":\"174046262\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/738c3a31-c34d-468d-bc2f-5472be494a69-profile_image-300x300.png\",\"title\":\"PS5ChrisDLC\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdees\",\"display_name\":\"robcdees\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244260925\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/a23f636e-30b3-4e57-97eb-8e969d8d7ded-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeq\",\"display_name\":\"robcdeeq\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244547010\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/9e8a14be-af0f-40af-9891-612563148d2f-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeew\",\"display_name\":\"robcdeew\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244828100\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ead5c8b2-a4c9-4724-b1dd-9f00b46cbd3d-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeb\",\"display_name\":\"robcdeeb\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"254618761\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ce57700a-def9-11e9-842d-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeek\",\"display_name\":\"robcdeek\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255125137\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/96af2236-b75e-4081-9cfe-bf1727063034-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeej\",\"display_name\":\"robcdeej\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255180414\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeeed\",\"display_name\":\"robcdeeed\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255464585\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ebe4cd89-b4f4-4cd9-adac-2f30151b4209-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeeqh\",\"display_name\":\"robcdeeqh\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255788974\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ebe4cd89-b4f4-4cd9-adac-2f30151b4209-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee4r\",\"display_name\":\"robcdee4r\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"256985781\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeejag\",\"display_name\":\"robcdeejag\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"456396300\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/b6b0f49f-772c-42d4-b0ad-12090d67456c-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeznuts\",\"display_name\":\"robcdeeznuts\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"571158422\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/998f01ae-def8-11e9-b95c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeehy\",\"display_name\":\"robcdeehy\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"572025385\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/de130ab0-def7-11e9-b668-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeert\",\"display_name\":\"robcdeert\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"591739541\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/998f01ae-def8-11e9-b95c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeenyt\",\"display_name\":\"robcdeenyt\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"710849550\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/f3d9a060-8293-4ed8-8b75-7ecf0f874cf4-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdee802\",\"display_name\":\"robcdee802\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"733226724\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/de130ab0-def7-11e9-b668-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee_1187\",\"display_name\":\"robcdee_1187\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"807660849\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee_\",\"display_name\":\"robcdee_\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"841370023\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeee2\",\"display_name\":\"robcdeee2\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"851757142\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/294c98b5-e34d-42cd-a8f0-140b72fba9b0-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"}],\"pagination\":{\"cursor\":\"MjA=\"}}{\"data\":[{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdee\",\"display_name\":\"robcdee\",\"game_id\":\"509658\",\"game_name\":\"JustChatting\",\"id\":\"169185650\",\"is_live\":false,\"tag_ids\":[],\"tags\":[\"Tokyo\",\"Japan\",\"Outdoors\",\"Cycling\",\"Exploration\",\"Travel\",\"SocialEating\",\"Anime\",\"Speedeating\",\"English\"],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/27b90dee-a5c1-4f04-aaba-52ca8f68f224-profile_image-300x300.png\",\"title\":\"CYCLEATHON2|Day4:Today'sgoalisIshinomaki!~95km|1sub=200m/100bits=40m/$1=40m|!map!progress!vpn\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeenumber1\",\"display_name\":\"robcdeenumber1\",\"game_id\":\"492934\",\"game_name\":\"ResidentEvil7biohazard\",\"id\":\"174046262\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/738c3a31-c34d-468d-bc2f-5472be494a69-profile_image-300x300.png\",\"title\":\"PS5ChrisDLC\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdees\",\"display_name\":\"robcdees\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244260925\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/a23f636e-30b3-4e57-97eb-8e969d8d7ded-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeq\",\"display_name\":\"robcdeeq\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244547010\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/9e8a14be-af0f-40af-9891-612563148d2f-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeew\",\"display_name\":\"robcdeew\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"244828100\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ead5c8b2-a4c9-4724-b1dd-9f00b46cbd3d-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeb\",\"display_name\":\"robcdeeb\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"254618761\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ce57700a-def9-11e9-842d-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeek\",\"display_name\":\"robcdeek\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255125137\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/96af2236-b75e-4081-9cfe-bf1727063034-profile_image-300x300.jpg\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeej\",\"display_name\":\"robcdeej\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255180414\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeeed\",\"display_name\":\"robcdeeed\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255464585\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ebe4cd89-b4f4-4cd9-adac-2f30151b4209-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeeqh\",\"display_name\":\"robcdeeqh\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"255788974\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/ebe4cd89-b4f4-4cd9-adac-2f30151b4209-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee4r\",\"display_name\":\"robcdee4r\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"256985781\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeejag\",\"display_name\":\"robcdeejag\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"456396300\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/b6b0f49f-772c-42d4-b0ad-12090d67456c-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeeznuts\",\"display_name\":\"robcdeeznuts\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"571158422\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/998f01ae-def8-11e9-b95c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeehy\",\"display_name\":\"robcdeehy\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"572025385\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/de130ab0-def7-11e9-b668-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeert\",\"display_name\":\"robcdeert\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"591739541\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/998f01ae-def8-11e9-b95c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdeenyt\",\"display_name\":\"robcdeenyt\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"710849550\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/jtv_user_pictures/f3d9a060-8293-4ed8-8b75-7ecf0f874cf4-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"en\",\"broadcaster_login\":\"robcdee802\",\"display_name\":\"robcdee802\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"733226724\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/de130ab0-def7-11e9-b668-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee_1187\",\"display_name\":\"robcdee_1187\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"807660849\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdee_\",\"display_name\":\"robcdee_\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"841370023\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"},{\"broadcaster_language\":\"\",\"broadcaster_login\":\"robcdeee2\",\"display_name\":\"robcdeee2\",\"game_id\":\"0\",\"game_name\":\"\",\"id\":\"851757142\",\"is_live\":false,\"tag_ids\":[],\"tags\":[],\"thumbnail_url\":\"https://static-cdn.jtvnw.net/user-default-pictures-uv/294c98b5-e34d-42cd-a8f0-140b72fba9b0-profile_image-300x300.png\",\"title\":\"\",\"started_at\":\"\"}],\"pagination\":{\"cursor\":\"MjA=\"}}";

void setup() {
Serial.begin(115200);
getpreferences();
WiFiManager wm;
wm.resetSettings();
WiFiManagerParameter custom_text_box("my_text","Enter Channel Name","",50);
wm.addParameter(&custom_text_box);
if (channelName.length()>1)
{custom_text_box.setValue(channelName.c_str(),channelName.length());
}

 bool res;
    // res = wm.autoConnect(); // auto generated AP name from chipid
    // res = wm.autoConnect("AutoConnectAP"); // anonymous ap
    res = wm.autoConnect("AutoConnectAP","password"); // password protected ap

    if(!res) {
        Serial.println("Failed to connect");
        // ESP.restart();
    } 
    else {
        //if you get here you have connected to the WiFi    
        Serial.println("connected...yeey :)");
    }
Serial.println(custom_text_box.getValue());
  preferences.begin("my-app", false);
  preferences.putString("channel",custom_text_box.getValue());
  preferences.end();

  DynamicJsonDocument doc(2500);
      DynamicJsonDocument filter(2000);
       filter["data"][0]["game_name"] = true;
        filter["data"][0]["is_live"] = true;
         deserializeJson(doc, jsonStr, DeserializationOption::Filter(filter));

  // Print the result
  serializeJsonPretty(doc, Serial);
     Serial.println("##############################################");
for(int i=0; i<1; i++){
  Serial.println("##############  "+(String)i+ "  ###################");
  String gamename = doc["data"][0]["game_name"];
 
  String livestatus = doc["data"][0]["is_live"];
 
  Serial.println("GAME NAME : " + (String)gamename);
  Serial.println("LIVESTATUS : " + (String)livestatus);
 
}
}

void loop() {
  // put your main code here, to run repeatedly:
}